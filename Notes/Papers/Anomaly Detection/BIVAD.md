<h2>1. Abstract</h2>
Investigate forward and backward motion continuity between adjacent frames and propose a new video anomaly detection paradigm based on bi-directional frame interpolation. The proposed framework consists of an optical flow estimation network and an interpolation network jointly optimized end-to-end to synthesize a middle frame from its nearest two frames. We further introduce a novel dynamic memory mechanism to balance memory sparsity and normality representation diversity, which attenuates abnormal features in frame interpolation without affecting normal prototypes. In inference, interpolation error and dynamic memory error are fused as anomaly scores.
<h2>2. Methodology</h2>
The proposed method takes its previous frame $I_{t - 1}$ and future frame $I_{t + 1}$ as input and infers the forward and backward optical flows between these two frames. Then the optical flows, together with the two frames, are concatenated and fed into the interpolation network to synthesize the “normal” version of the current frame $\hat{I}_t$. The interpolation error between the target $I_t$ and its normal version $\hat{I}_t$ is an indicator of anomaly. 
<h3>2.1 Frame interpolation</h3>
Given a video sequence $\{I_0,...,I_{t - 1}, I_t, I_{t + 1},...,I_N\}$ of $N$ + 1 frames, the goal is to predict a sequence $\{\hat{I}_1,...,\hat{I}_{t - 1},\hat{I}_t,\hat{I}_{t + 1},...,\hat{I}_{N - 1}\}$ by interpolation of the neighboring two frames for each time step $t$. Let $F_{t - 1 \rightarrow t + 1}$ and $F_{t + 1 \rightarrow t - 1}$ denote the optical flow from $I_{t - 1}$ to $I_{t + 1}$ and $I_{t + 1}$ to $I_{t - 1}$. Given the flows between frame $t - 1$ and $t + 1$, the intermediate frame can be obtained by warping with the interpolated optical flow. Since frame at $t$ located at center of two frames at $t - 1$ and $t + 1$, we have OF from $I_t$ to $I_{t - 1}$ as: $F_{t \rightarrow t - 1} = \frac{1}{2}F_{t + 1 \rightarrow t - 1} = -\frac{1}{2}F_{t - 1 \rightarrow t + 1}$ and the OF from $I_t$ to $I_{t + 1}$ as: $F_{t \rightarrow t + 1} = \frac{1}{2}F_{t - 1 \rightarrow t + 1} = -\frac{1}{2}F_{t + 1 \rightarrow t - 1}$. Then the optical flows from $I_t$ to $I_{t - 1}$ and from $I_t$ to $I_{t + 1}$ are interpolated linearly as follows: $\hat{F}_{t \rightarrow t - 1} = -\frac{1}{4}F_{t - 1 \rightarrow t + 1} + \frac{1}{4}F_{t + 1 \rightarrow t - 1}, \hat{F}_{t \rightarrow t + 1} = \frac{1}{4}F_{t - 1 \rightarrow t + 1} - \frac{1}{4}F_{t + 1 \rightarrow t - 1}$. Use U-Net to predict the bidirectional optical flows $F_{t - 1 \rightarrow t + 1}$ and $F_{t + 1 \rightarrow t - 1}$. We can get the frame $I_{t - 1 \rightarrow t}$ and $I_{t + 1 \rightarrow t}$ at time $t$ by backward warping operation: $I_{t - 1 \rightarrow t} = \phi(I_{t - 1}, \hat{F}_{t \rightarrow t - 1}), I_{t + 1 \rightarrow t} = \phi(I_{t + 1}, \hat{F}_{t \rightarrow t + 1})$. Another interpolation model $\mathcal{R}$ is applied for refinement of frame at $t$, whose output is the final interpolated result $\hat{I}_t$: $\hat{I}_t = \mathcal{R}(\hat{F}_{t \rightarrow t - 1}; I_{t - 1 \rightarrow t}; \hat{F}_{t \rightarrow t + 1}; I_{t + 1 \rightarrow t})$.
<h3>2.2 Dynamic memory mechanism</h3>
The memory pool $M \in \mathbb{R}^{N \times C}$ is defined as a matrix consisting $N$ keys with each key of dimension $C$. Given the feature map $Q \in \mathbb{R}^{H \times W \times C}$ extracted from a frame, linearly query its mapped features on the normality space from the memory pool. For each input feature vector $q_{ij} \in \mathbb{R}^C$ in the feature map $Q$, use cosine similarity to represent the matching extent: $\omega(k_m, q_{ij}) = \frac{k^T_mq_{ij}}{||k_m||||q_{ij}||}$, where $k_m$ is $m$-th key in memory pool. Then the matching probabilities between $q_{ij}$ and top $K$ selected keys are given by: $\hat{p}_m = \frac{\exp{\omega(k_m, q_{ij})}}{\sum_{n = 1}^K\exp(\omega(k_n, q_{ij}))}$. The addressing result $v_{ij}$ is obtained by weighted average of all selected keys $v_{ij} = \sum_{n = 1}^K\hat{p}_n \cdot k_n$. Then, add it as a residual term to query $q_{ij}$ as the output of the memory module.
<h3>2.3 Joint training</h3>
$\mathcal{L} = \mathcal{L}_{warp} + \mathcal{L}_{frame} + \lambda_1\mathcal{L}_{SSIM} + \lambda_2\mathcal{L}_{con} + \lambda_3\mathcal{L}_{div}$, where $\mathcal{L}_{warp} = ||I_{t - 1} - \phi(I_{t + 1}, F_{t - 1 \rightarrow t + 1})||^2 + ||I_{t + 1} - \phi(I_{t - 1}, F_{t + 1 \rightarrow t - 1})||^2$, $\mathcal{L}_{frame} = ||I_t - \hat{I}_t||_2$, $\mathcal{L}_{SSIM} = SSIM(I_t, \hat{I}_t)$, $\mathcal{L}_{con} = \frac{1}{HW}\sum_{i = 1}^H\sum_{j = 1}^W||v_{ij} - q_{ij}||_2$, $\mathcal{L}_{div} = -\frac{1}{N^2}\sum_{n = 1}^N\sum_{n'=1}^N||k_n - k_{n'}||_2$.
<h3>2.4 Anomaly score</h3>
$S = \alpha\phi(S_{int}) + (1 - \alpha)\phi(S_{con})$, where $S_{int} = \mathcal{L}_{frame} = ||I_t - \hat{I}_t||_2, S_{con} = \mathcal{L}_{con} = \frac{1}{HW}\sum_{i = 1}^H\sum_{j = 1}^W||v_{ij} - q_{ij}||_2$, where $\phi(*)$ denotes min-max normalization.
<h2>3. Datasets</h2>
UCSD Ped2, CUHK Avenue and ShanghaiTech.
<h2>4. Metrics</h2>
AUC.